{% set width = image['sizes'][size ~ '-width'] %}
{% set height = image['sizes'][size ~ '-height'] %}
{% set ratio = height / width %}

{% if constrain_width %}<div style="width: 100%; max-width: {{ width }}px;">{% endif %}
<div class="image" style="padding-top: {{ (ratio * 100) }}%;">
  <img src="{{ image['sizes'][size] }}" alt="{{ image['alt'] }}" width="{{ width }}" height="{{ height }}" loading="lazy" />
</div>
{% if constrain_width %}</div>{% endif %}